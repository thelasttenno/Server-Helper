# Authentik Setup Guide

## Initial Access

1. Access Authentik at: https://{{ authentik_domain }}
2. Login with initial admin credentials:
   - Email: `{{ authentik_bootstrap_email }}`
   - Password: (from vault)

## Post-Installation Setup

### 1. Change Admin Password
- Go to **Directory** > **Users**
- Select the admin user
- Change the password immediately

### 2. Configure Branding
- Go to **System** > **Brands**
- Customize logo, favicon, and colors

### 3. Create OAuth2 Applications

For each service (Grafana, etc.):

1. Go to **Applications** > **Applications** > **Create**
2. Name: e.g., "Grafana"
3. Slug: e.g., "grafana"
4. Provider: Create new OAuth2/OpenID Provider
   - Name: e.g., "Grafana Provider"
   - Authorization flow: default-provider-authorization-implicit-consent
   - Client ID: (auto-generated, copy this)
   - Client Secret: (auto-generated, copy this)
   - Redirect URIs: `https://grafana.{{ target_domain | default('local') }}/login/generic_oauth`

### 4. Application Configurations

#### Grafana
Add to `grafana.ini` or environment:
```ini
[auth.generic_oauth]
enabled = true
name = Authentik
client_id = <client_id>
client_secret = <client_secret>
scopes = openid profile email
auth_url = https://{{ authentik_domain }}/application/o/authorize/
token_url = https://{{ authentik_domain }}/application/o/token/
api_url = https://{{ authentik_domain }}/application/o/userinfo/
```

#### Traefik Forward Auth
Create a Proxy Provider in Authentik:
1. Go to **Applications** > **Providers** > **Create**
2. Type: Proxy Provider
3. Name: "Traefik Forward Auth"
4. External host: https://auth.{{ target_domain | default('local') }}
5. Mode: Forward auth (single application)

## User Management

### Create Users
- Go to **Directory** > **Users** > **Create**
- Set username, email, and password
- Assign to groups as needed

### Create Groups
- Go to **Directory** > **Groups** > **Create**
- Example groups: "Admins", "Grafana Admins", "Developers"

## Security Recommendations

1. Enable MFA: **Directory** > **Users** > User > **MFA Devices**
2. Set up password policies: **Customisation** > **Policies**
3. Configure session timeouts: **System** > **Tenants**
4. Enable audit logging review: **Events** > **Logs**

---
Generated by Server Helper Ansible
