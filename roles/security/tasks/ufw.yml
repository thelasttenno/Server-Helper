---
# UFW Firewall Configuration

- name: Set UFW default incoming policy
  community.general.ufw:
    direction: incoming
    policy: "{{ security.ufw.default_incoming }}"

- name: Set UFW default outgoing policy
  community.general.ufw:
    direction: outgoing
    policy: "{{ security.ufw.default_outgoing }}"

- name: Configure UFW rules
  community.general.ufw:
    rule: allow
    port: "{{ item.port }}"
    proto: "{{ item.proto }}"
    comment: "{{ item.comment }}"
  loop: "{{ security.ufw.rules }}"

- name: Enable UFW
  community.general.ufw:
    state: enabled

- name: Display UFW status
  ansible.builtin.command: ufw status verbose
  register: ufw_status
  changed_when: false

- name: Show UFW status
  ansible.builtin.debug:
    var: ufw_status.stdout_lines
