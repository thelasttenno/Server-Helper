---
- name: Verify
  hosts: all
  gather_facts: true
  tasks:
    - name: Check fail2ban is installed
      ansible.builtin.package:
        name: fail2ban
        state: present
      check_mode: true
      register: f2b_check
      failed_when: f2b_check.changed

    - name: Check SSH hardening config exists
      ansible.builtin.stat:
        path: /etc/ssh/sshd_config.d/99-hardening.conf
      register: ssh_hardening
      failed_when: not ssh_hardening.stat.exists
