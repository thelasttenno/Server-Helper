---
# Role: qemu_agent â€” Install qemu-guest-agent for VM host visibility
# Only runs on KVM/QEMU virtual machines

- name: Skip QEMU agent message
  ansible.builtin.debug:
    msg: "Skipping QEMU agent (qemu_agent_skip={{ qemu_agent_skip }})"
  when: qemu_agent_skip | bool

- name: Install qemu-guest-agent
  ansible.builtin.apt:
    name: qemu-guest-agent
    state: present
  when:
    - not (qemu_agent_skip | bool)
    - ansible_virtualization_type in ['kvm', 'qemu']

- name: Enable and start qemu-guest-agent
  ansible.builtin.systemd:
    name: qemu-guest-agent
    enabled: true
    state: started
  when:
    - not (qemu_agent_skip | bool)
    - ansible_virtualization_type in ['kvm', 'qemu']
