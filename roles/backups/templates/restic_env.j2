# Restic Environment Variables
# Generated by Server Helper v1.0.0

# Backup password (keep this secure!)
export RESTIC_PASSWORD="{{ lookup('password', '/dev/null length=32 chars=ascii_letters,digits') }}"

# Repository destinations
{% if backups.destinations.local.enabled | default(false) %}
export RESTIC_REPO_LOCAL="{{ backups.destinations.local.path }}"
{% endif %}

{% if backups.destinations.nas.enabled | default(false) %}
export RESTIC_REPO_NAS="{{ backups.destinations.nas.path }}"
{% endif %}

{% if backups.destinations.s3.enabled | default(false) %}
export RESTIC_REPO_S3="s3:{{ backups.destinations.s3.endpoint }}/{{ backups.destinations.s3.bucket }}"
export AWS_ACCESS_KEY_ID="{{ backups.destinations.s3.access_key }}"
export AWS_SECRET_ACCESS_KEY="{{ backups.destinations.s3.secret_key }}"
export AWS_DEFAULT_REGION="{{ backups.destinations.s3.region }}"
{% endif %}

{% if backups.destinations.b2.enabled | default(false) %}
export RESTIC_REPO_B2="b2:{{ backups.destinations.b2.bucket }}"
export B2_ACCOUNT_ID="{{ backups.destinations.b2.account_id }}"
export B2_ACCOUNT_KEY="{{ backups.destinations.b2.account_key }}"
{% endif %}

{% if backups.destinations.sftp.enabled | default(false) %}
export RESTIC_REPO_SFTP="sftp:{{ backups.destinations.sftp.user }}@{{ backups.destinations.sftp.host }}:{{ backups.destinations.sftp.path }}"
{% endif %}

# Uptime Kuma push monitor
{% if monitoring.uptime_kuma.push_monitors.backup is defined and monitoring.uptime_kuma.push_monitors.backup != '' %}
export UPTIME_KUMA_BACKUP_URL="{{ monitoring.uptime_kuma.push_monitors.backup }}"
{% endif %}
