# Netdata Docker Container Alarms
# Generated by Ansible - Server Helper v1.0.0

# Docker container state alarm - detects unhealthy/stopped containers
alarm: docker_container_unhealthy
   on: docker_container.health_status
class: Errors
 type: Container
component: Docker
hosts: *
 calc: $unhealthy + $not_running_unhealthy
units: containers
every: 30s
 warn: $this > 0
delay: up 1m down 5m
 info: unhealthy Docker containers detected
   to: sysadmin

# Docker container CPU usage alarm
alarm: docker_container_cpu_high
   on: docker_container.cpu
class: Utilization
 type: Container
component: Docker
hosts: *
 calc: $cpu
units: %
every: 1m
 warn: $this > 80
 crit: $this > 95
delay: down 15m multiplier 1.5 max 1h
 info: Docker container is using excessive CPU
   to: sysadmin

# Docker container memory usage alarm
alarm: docker_container_mem_high
   on: docker_container.mem
class: Utilization
 type: Container
component: Docker
hosts: *
 calc: $used * 100 / $limit
units: %
every: 1m
 warn: $this > 80
 crit: $this > 95
delay: down 15m multiplier 1.5 max 1h
 info: Docker container is using excessive memory
   to: sysadmin

# Docker container restart alarm
alarm: docker_container_restarting
   on: docker_container.state
class: Errors
 type: Container
component: Docker
hosts: *
lookup: sum -5m unaligned of restarting
 units: restarts
every: 1m
 warn: $this > 0
delay: up 30s down 5m
 info: Docker container is restarting frequently
   to: sysadmin

# Critical containers stopped alarm (Dockge, Netdata, Uptime Kuma)
alarm: critical_docker_container_stopped
   on: docker_container.state
class: Errors
 type: Container
component: Docker
hosts: *
 calc: $running
units: boolean
every: 30s
 crit: $this == 0
delay: up 1m down 5m
 info: critical Docker container is not running
   to: sysadmin
families: dockge netdata uptime-kuma

# Docker daemon health
alarm: dockerd_unhealthy
   on: docker_engine_daemon.health_status
class: Errors
 type: Docker
component: Docker
hosts: *
 calc: $unhealthy
units: boolean
every: 30s
 crit: $this > 0
delay: up 1m down 5m
 info: Docker daemon is unhealthy
   to: sysadmin
