# {{ ansible_managed }}
services:
  loki:
    image: grafana/loki:{{ control_loki.version }}
    container_name: loki
    restart: unless-stopped
    ports:
      - "{{ control_loki.port }}:3100"
    env_file:
      - .env
    volumes:
      - ./loki-config.yml:/etc/loki/local-config.yaml:ro
      - loki-data:/loki
    command: -config.file=/etc/loki/local-config.yaml
    networks:
      - traefik-public
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3100/ready"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s

volumes:
  loki-data:

networks:
  traefik-public:
    external: true
