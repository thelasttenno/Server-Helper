# Traefik Reverse Proxy
# Deployed by Server Helper

version: '3.8'

services:
  traefik:
    image: traefik:{{ proxy_traefik_version }}
    container_name: traefik
    restart: unless-stopped
    ports:
      - "{{ proxy_http_port }}:80"
      - "{{ proxy_https_port }}:443"
{% if proxy_dashboard_enabled | bool %}
      - "{{ proxy_dashboard_port }}:8080"
{% endif %}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - {{ proxy_config_dir }}/traefik.yml:/etc/traefik/traefik.yml:ro
      - {{ proxy_dynamic_dir }}:/etc/traefik/dynamic:ro
      - {{ proxy_certs_dir }}:/certs
    environment:
      - TZ={{ timezone | default('UTC') }}
    labels:
      - "traefik.enable=true"
      - "com.server-helper.service=traefik"
      - "com.server-helper.description=Reverse Proxy"
    networks:
      - {{ proxy_network_name }}
    healthcheck:
      test: ["CMD", "traefik", "healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  {{ proxy_network_name }}:
    external: true
