# Uptime Kuma Setup Guide
## Server Helper v1.0.0

### Initial Setup

1. **Access Uptime Kuma**
   - URL: http://{{ ansible_default_ipv4.address }}:{{ monitoring.uptime_kuma.port }}
   - Create admin account on first visit

2. **Configure Monitors**

   Add the following monitors:

   #### Docker Host Monitor
   - Type: Docker Container
   - Docker Host: Use Docker socket `/var/run/docker.sock`
   - Check all critical containers

   #### Dockge Monitor
   - Type: HTTP(s)
   - URL: http://dockge:5001
   - Friendly Name: "Dockge"
   - Heartbeat Interval: 60 seconds

   #### Netdata Monitor
   - Type: HTTP(s)
   - URL: http://netdata:19999
   - Friendly Name: "Netdata"
   - Heartbeat Interval: 60 seconds

{% if nas_mounts.enabled | default(false) %}
   #### NAS Connectivity Monitors
{% for share in nas_mounts.shares %}
   - Type: Ping
   - Hostname: {{ share.ip }}
   - Friendly Name: "NAS - {{ share.name }}"
   - Heartbeat Interval: 120 seconds
{% endfor %}
{% endif %}

3. **Configure Notifications**

   Set up notification channels:
   - Email (SMTP)
   - Discord
   - Slack
   - Telegram
   - Webhook
   - etc.

4. **Push Monitors for Backups**

   Create push monitors for backup jobs:
   - Go to "Add New Monitor"
   - Select "Push" type
   - Copy the push URL
   - Add to group_vars/all.yml under monitoring.uptime_kuma.push_monitors.backup

5. **Set Up Status Pages** (Optional)

   Create public or private status pages showing system health.

### Integration with Restic Backups

After creating a push monitor for backups:

1. Copy the push URL from Uptime Kuma
2. Edit `group_vars/all.yml`:
   ```yaml
   monitoring:
     uptime_kuma:
       push_monitors:
         backup: "http://{{ ansible_default_ipv4.address }}:{{ monitoring.uptime_kuma.port }}/api/push/xxxxx"
   ```
3. Re-run the backups role:
   ```bash
   ansible-playbook playbooks/setup.yml --tags backups
   ```

### Monitoring Best Practices

- **Set appropriate heartbeat intervals**: Don't over-monitor (increases resource usage)
- **Configure retry counts**: Avoid false alerts
- **Group related monitors**: Organize by service type
- **Use maintenance windows**: Schedule known downtime
- **Test notifications**: Verify alerts are delivered

### Dashboard Widgets

Recommended dashboard layout:
1. Overall system uptime
2. Critical services status
3. Docker container health
4. NAS connectivity
5. Recent events timeline

### Alerting Strategy

```
Critical (Immediate):
- Dockge down
- Docker daemon down
- Primary NAS unreachable

Warning (5 min delay):
- High resource usage
- Backup failures
- Secondary services down

Info (No alert):
- Backup success
- System updates available
```

---

For more information: https://github.com/louislam/uptime-kuma
