# Uptime Kuma Setup Guide
# Generated by Ansible - Server Helper v1.0.0

## ğŸš€ Quick Start

### 1. Access Uptime Kuma

Open your web browser and navigate to:
```
http://{{ ansible_host }}:{{ uptime_kuma.port }}
```

### 2. Create Admin Account

On first access, you'll be prompted to create an admin account:

- **Username**: `{{ vault_uptime_kuma_credentials.username }}`
- **Password**: `{{ vault_uptime_kuma_credentials.password }}`

**IMPORTANT**: Change these credentials after first login!

---

## ğŸ“Š Recommended Monitors

### Pull Monitors (HTTP/Ping)

#### 1. Netdata Health
- **Type**: HTTP(s)
- **Name**: Netdata Health
- **URL**: `http://localhost:{{ monitoring.netdata.port }}/api/v1/info`
- **Interval**: 60 seconds
- **Expected Status**: 200

#### 2. Dockge
- **Type**: HTTP(s)
- **Name**: Dockge
- **URL**: `http://localhost:{{ dockge.port }}/`
- **Interval**: 60 seconds
- **Expected Status**: 200

#### 3. Docker Daemon
- **Type**: HTTP(s)
- **Name**: Docker Daemon
- **URL**: `http://localhost:2375/_ping`
- **Interval**: 60 seconds
- **Expected Status**: 200
- **Note**: Requires Docker API to be exposed

#### 4. NAS Connectivity
{% if nas.enabled | default(false) %}
{% for share in nas.shares | default([]) %}
- **Type**: Ping
- **Name**: NAS - {{ share.mount }}
- **Hostname**: {{ share.ip }}
- **Interval**: 120 seconds
{% endfor %}
{% else %}
- **Type**: Ping
- **Name**: NAS
- **Hostname**: 192.168.1.100
- **Interval**: 120 seconds
{% endif %}

---

### Push Monitors (Webhook-based)

Create push monitors and copy the webhook URLs to your vault:

#### 5. System Health
- **Type**: Push
- **Name**: System Health
- **Heartbeat Interval**: 5 minutes
- **Copy webhook URL to**: `vault_uptime_kuma_push_urls.system`

#### 6. Backup Status
- **Type**: Push
- **Name**: Backup Status
- **Heartbeat Interval**: 24 hours
- **Copy webhook URL to**: `vault_uptime_kuma_push_urls.backup`

#### 7. Security Scan
- **Type**: Push
- **Name**: Security Scan
- **Heartbeat Interval**: 7 days
- **Copy webhook URL to**: `vault_uptime_kuma_push_urls.security`

#### 8. Netdata CPU Alert
- **Type**: Push
- **Name**: Netdata CPU
- **Heartbeat Interval**: 5 minutes
- **Copy webhook URL to**: `vault_uptime_kuma_push_urls.cpu` (in netdata.alarms section)

#### 9. Netdata RAM Alert
- **Type**: Push
- **Name**: Netdata RAM
- **Heartbeat Interval**: 5 minutes
- **Copy webhook URL to**: `vault_uptime_kuma_push_urls.ram` (in netdata.alarms section)

#### 10. Netdata Disk Alert
- **Type**: Push
- **Name**: Netdata Disk
- **Heartbeat Interval**: 5 minutes
- **Copy webhook URL to**: `vault_uptime_kuma_push_urls.disk` (in netdata.alarms section)

---

## ğŸ“ How to Add Push URLs to Vault

### 1. Edit vault.yml
```bash
ansible-vault edit group_vars/vault.yml
```

### 2. Add/Update Push URLs
```yaml
vault_uptime_kuma_push_urls:
  system: "http://localhost:3001/api/push/ABC123XYZ?status=up&msg=OK"
  backup: "http://localhost:3001/api/push/DEF456XYZ?status=up&msg=OK"
  security: "http://localhost:3001/api/push/GHI789XYZ?status=up&msg=OK"
  nas: "http://localhost:3001/api/push/JKL012XYZ?status=up&msg=OK"
  dockge: "http://localhost:3001/api/push/MNO345XYZ?status=up&msg=OK"
  update: "http://localhost:3001/api/push/PQR678XYZ?status=up&msg=OK"
```

### 3. Update group_vars/all.yml (if needed)
```yaml
netdata:
  alarms:
    uptime_kuma_urls:
      cpu: "{{ vault_uptime_kuma_push_urls.cpu }}"
      ram: "{{ vault_uptime_kuma_push_urls.ram }}"
      disk: "{{ vault_uptime_kuma_push_urls.disk }}"
      docker: "{{ vault_uptime_kuma_push_urls.docker }}"
```

### 4. Re-run setup
```bash
ansible-playbook playbooks/setup.yml
```

---

## ğŸ”” Notification Channels

### Email (SMTP)
1. Go to **Settings** â†’ **Notifications**
2. Click **Setup Notification**
3. Select **Email (SMTP)**
4. Configure:
{% if notifications.email.enabled | default(false) %}
   - SMTP Host: {{ vault_smtp_credentials.host }}
   - SMTP Port: {{ vault_smtp_credentials.port }}
   - Username: {{ vault_smtp_credentials.username }}
   - Password: (from vault)
   - From: {{ vault_smtp_credentials.from_address }}
   - To: {{ vault_smtp_credentials.to_addresses | join(', ') }}
{% else %}
   - SMTP Host: smtp.gmail.com
   - SMTP Port: 587
   - Use App Password for Gmail
{% endif %}

### Discord
1. Create Discord webhook in your server
2. Go to **Settings** â†’ **Notifications**
3. Select **Discord**
4. Paste webhook URL

### Telegram
1. Create bot with @BotFather
2. Get chat ID from @userinfobot
3. Go to **Settings** â†’ **Notifications**
4. Select **Telegram**
5. Enter bot token and chat ID

---

## ğŸ¨ Status Pages

Create public status page:
1. Go to **Status Pages**
2. Click **New Status Page**
3. Add monitors to display
4. Customize theme and branding
5. Share public URL

---

## ğŸ” Security Best Practices

1. **Change default credentials** immediately after setup
2. **Enable 2FA** in Settings â†’ Security
3. **Use HTTPS** if exposing externally (setup reverse proxy)
4. **Backup database** regularly:
   ```bash
   docker exec uptime-kuma cat /app/data/kuma.db > ~/uptime-kuma-backup.db
   ```
5. **Limit access** with firewall rules or VPN

---

## ğŸ› ï¸ Automated Setup Helper

Run the automated setup helper script:
```bash
sudo /usr/local/bin/configure-uptime-kuma-monitors.sh
```

This script will guide you through creating push monitors and updating vault with URLs.

---

## ğŸ“š Additional Resources

- **Documentation**: https://github.com/louislam/uptime-kuma/wiki
- **API Docs**: http://localhost:{{ uptime_kuma.port }}/api-docs
- **Community**: https://github.com/louislam/uptime-kuma/discussions

---

## ğŸ†˜ Troubleshooting

### Cannot Access UI
```bash
# Check container status
docker ps | grep uptime-kuma

# Check logs
docker logs uptime-kuma

# Restart container
cd {{ dockge.data_dir }}/stacks/uptime-kuma
docker compose restart
```

### Forgot Password
```bash
# Reset admin password
docker exec -it uptime-kuma npm run reset-password
```

### Push Monitors Not Working
1. Check webhook URL is correct
2. Verify heartbeat interval is appropriate
3. Test manually:
   ```bash
   curl -fsS "YOUR_PUSH_URL?status=up&msg=test"
   ```

---

**Setup complete! Enjoy monitoring with Uptime Kuma!** ğŸ‰
