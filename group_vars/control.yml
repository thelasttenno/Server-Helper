---
# =============================================================================
# Server Helper v0.4.0 â€” Control Node Variables
# =============================================================================
# Variables specific to the control node services (Tier 3).

# -----------------------------------------------------------------------------
# Traefik (Reverse Proxy)
# -----------------------------------------------------------------------------
control_traefik:
  enabled: true
  version: "v3.0"
  http_port: 80
  https_port: 443
  dashboard_port: 8080
  acme_email: "admin@{{ target_domain }}"
  acme_dns_provider: "cloudflare"
  log_level: "INFO"
  security_headers:
    browser_xss_filter: true
    content_type_nosniff: true
    frame_deny: true
    ssl_redirect: true
    sts_seconds: 315360000
    sts_include_subdomains: true
    sts_preload: true

# -----------------------------------------------------------------------------
# Authentik (SSO/OIDC)
# -----------------------------------------------------------------------------
control_authentik:
  enabled: true
  version: "2024.2"
  port: 9000
  postgres_version: "16-alpine"
  redis_version: "7-alpine"

# -----------------------------------------------------------------------------
# Step-CA (Internal PKI)
# -----------------------------------------------------------------------------
control_step_ca:
  enabled: true
  version: "latest"
  port: 9443
  ca_name: "{{ target_domain }} Internal CA"
  provisioner_name: "acme"
  cert_duration: "24h"
  max_cert_duration: "720h"

# -----------------------------------------------------------------------------
# Pi-hole + Unbound (DNS)
# -----------------------------------------------------------------------------
control_dns:
  enabled: true
  pihole_version: "latest"
  pihole_port: 8053
  dns_port: 53
  unbound_version: "latest"
  dnssec: true

# Custom DNS records (A records)
pihole_custom_dns_records:
  - { ip: "{{ target_control_ip }}", hostname: "traefik.{{ target_domain }}" }
  - { ip: "{{ target_control_ip }}", hostname: "grafana.{{ target_domain }}" }
  - { ip: "{{ target_control_ip }}", hostname: "netdata.{{ target_domain }}" }
  - { ip: "{{ target_control_ip }}", hostname: "status.{{ target_domain }}" }
  - { ip: "{{ target_control_ip }}", hostname: "pihole.{{ target_domain }}" }
  - { ip: "{{ target_control_ip }}", hostname: "auth.{{ target_domain }}" }
  - { ip: "{{ target_control_ip }}", hostname: "step-ca.{{ target_domain }}" }
  - { ip: "{{ target_control_ip }}", hostname: "dockge.{{ target_domain }}" }

# Custom CNAME records
pihole_custom_cname_records: []

# -----------------------------------------------------------------------------
# Loki (Log Aggregation)
# -----------------------------------------------------------------------------
control_loki:
  enabled: true
  version: "2.9.4"
  port: 3100
  retention_period: "744h"  # 31 days

# -----------------------------------------------------------------------------
# Grafana (Dashboards)
# -----------------------------------------------------------------------------
control_grafana:
  enabled: true
  version: "latest"
  port: 3000
  plugins:
    - grafana-clock-panel
    - grafana-piechart-panel

# -----------------------------------------------------------------------------
# Uptime Kuma (Status Monitoring)
# -----------------------------------------------------------------------------
control_uptime_kuma:
  enabled: true
  version: "1"
  port: 3001

# -----------------------------------------------------------------------------
# Netdata Parent Mode
# -----------------------------------------------------------------------------
control_netdata:
  enabled: true
  version: "latest"
  port: 19999
  dbengine_multihost_disk_space: 2048  # MB
  history_seconds: 3600
