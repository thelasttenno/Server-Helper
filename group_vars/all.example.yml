---
# Server Helper Configuration
#
# This file contains configuration for BOTH target nodes and control node.
# Variables are organized with prefixes:
#   - target_*: Services deployed on managed servers (setup-targets.yml)
#   - control_*: Centralized services on control node (setup-control.yml)
#
# Copy this file to group_vars/all.yml and customize as needed.
# Alternatively, run setup.sh to generate configuration interactively.

# =============================================================================
# TARGET NODE CONFIGURATION
# =============================================================================

# Target: System Settings
target_hostname: "docker-server"
target_timezone: "UTC"  # Use 'timedatectl list-timezones' to see available
target_locale: "en_US.UTF-8"

# Target: Base Directories
target_base_dir: "/opt/server-helper"
target_dockge_base_dir: "/opt/dockge"
target_dockge_stacks_dir: "{{ target_dockge_base_dir }}/stacks"
target_dockge_data_dir: "{{ target_dockge_base_dir }}/data"

# Target: NAS Mounts
target_nas_mounts:
  enabled: false
  # shares:
  #   - name: "primary"
  #     ip: "192.168.1.100"
  #     share_name: "share"
  #     mount_point: "/mnt/nas"
  #     username: "{{ vault_nas_credentials[0].username }}"
  #     password: "{{ vault_nas_credentials[0].password }}"
  #     smb_version: "3.0"
  #     options: "_netdev,nofail"

# Target: LVM Configuration
target_lvm_config:
  enabled: false
  auto_extend_ubuntu: true
  custom_lvs: []
  # Example:
  # - lv_path: "/dev/my-vg/my-lv"
  #   extend_percent: 100
  #   resize_cmd: "resize2fs"
  create_lvs: []
  # Example:
  # - vg: "ubuntu-vg"
  #   lv: "docker-lv"
  #   size: "50G"
  #   fstype: "ext4"
  #   mount_point: "/var/lib/docker"

# Target: System Users
target_system_users:
  create_admin_user: false
  # admin_user: "admin"
  # admin_password: "{{ vault_system_users.admin_password }}"
  # admin_groups:
  #   - sudo
  #   - docker
  # admin_passwordless_sudo: true
  # admin_ssh_key: "{{ vault_system_users.admin_ssh_key }}"
  disable_root_password: true
  additional_users: []

# Target: Dockge (Container Management)
target_dockge:
  enabled: true
  port: 5001
  version: "1"

# Target: Netdata (System Monitoring)
target_netdata:
  enabled: true
  port: 19999
  version: "latest"
  claim_token: ""  # Get from: https://app.netdata.cloud
  claim_rooms: ""  # Room IDs (comma-separated)
  alarms:
    enabled: true
    cpu_warning: 80
    cpu_critical: 95
    ram_warning: 80
    ram_critical: 95
    disk_warning: 80
    disk_critical: 90
    check_interval_minutes: 5
  uptime_kuma_push_urls:
    cpu: ""      # e.g., http://localhost:3001/api/push/CPU123
    ram: ""      # e.g., http://localhost:3001/api/push/RAM123
    disk: ""     # e.g., http://localhost:3001/api/push/DISK123
    system: ""   # e.g., http://localhost:3001/api/push/SYS123

# Target: Restic (Encrypted Backups)
target_restic:
  enabled: false
  # schedule: "0 2 * * *"  # Daily at 2 AM
  # retention:
  #   keep_daily: 7
  #   keep_weekly: 4
  #   keep_monthly: 6
  #   keep_yearly: 2
  # destinations:
  #   nas:
  #     enabled: false
  #     path: "/mnt/nas/restic"
  #   local:
  #     enabled: false
  #     path: "/opt/backups/restic"
  #   s3:
  #     enabled: false
  #     bucket: "my-backup-bucket"
  #     endpoint: "s3.amazonaws.com"
  #     region: "us-east-1"
  #   b2:
  #     enabled: false
  # include_paths:
  #   - "{{ target_dockge_stacks_dir }}"
  #   - "{{ target_dockge_data_dir }}"
  #   - "/etc"
  #   - "/root"
  #   - "/home"
  # exclude_patterns:
  #   - "*.tmp"
  #   - "*.log"
  #   - "cache"
  #   - "*.cache"

# Target: Security
target_security:
  basic_hardening: true
  lynis:
    enabled: true
    schedule: "0 3 * * 0"  # Weekly on Sunday at 3 AM
  fail2ban:
    enabled: true
    sshd_maxretry: 3
    sshd_bantime: 86400  # 24 hours
  ufw:
    enabled: true
    default_incoming: deny
    default_outgoing: allow
  ssh_hardening:
    enabled: true
    permit_root_login: false
    password_authentication: false
    pubkey_authentication: true
    max_auth_tries: 3

# Target: Logging (Promtail only - streams to central Loki)
target_logging:
  promtail:
    enabled: true
    additional_jobs: []
    # Example:
    # - name: "nginx"
    #   path: "/var/log/nginx/*.log"

# Target: Reverse Proxy (Optional)
target_reverse_proxy:
  enabled: true
  traefik:
    port: 80
    dashboard_port: 8080
    https_port: 443
    version: "v3.0"

# Target: Watchtower (Container Auto-Updates)
target_watchtower:
  enabled: false
  schedule: "0 4 * * *"  # Daily at 4 AM
  cleanup: true

# Target: Docker Configuration
target_docker:
  version: "latest"
  compose_version: "v2"
  storage_driver: "overlay2"
  log_driver: "json-file"
  log_max_size: "10m"
  log_max_file: "3"

# Target: System Maintenance
target_maintenance:
  auto_cleanup:
    enabled: true
    disk_threshold: 80
    schedule: "0 5 * * 0"  # Weekly on Sunday at 5 AM
  auto_updates:
    enabled: false
    schedule: "0 6 * * 0"
    auto_reboot: false
    reboot_time: "03:00"

# Target: Ansible Pull (Self-Update)
# Automatically pulls and applies configuration from a Git repository
target_ansible_pull:
  enabled: false
  # repo_url: "https://github.com/youruser/Server-Helper.git"
  # branch: "main"
  # schedule: "0 5 * * *"
  # check_only: false
  # playbook: "playbooks/setup-targets.yml"
  # log_file: "/var/log/ansible-pull.log"

# Target: Virtualization
target_virtualization:
  qemu_guest_agent: false

# Target: Performance Tuning
target_performance:
  tuning_enabled: false

# =============================================================================
# CONTROL NODE CONFIGURATION
# =============================================================================

control_node_install_dir: "/opt/control-node"

# Control: Uptime Kuma (Centralized Monitoring)
control_uptime_kuma:
  enabled: true
  port: 3001
  version: "1"

# Control: Grafana (Centralized Dashboards)
control_grafana:
  enabled: true
  port: 3000
  version: "latest"
  admin_user: "admin"

# Control: Loki (Centralized Log Aggregation)
control_loki:
  enabled: true
  port: 3100
  version: "latest"
  retention_period: "744h"  # 31 days

# Control: Netdata Parent (Centralized Metrics)
control_netdata:
  enabled: true
  port: 19999
  version: "latest"
  stream_api_key: "{{ vault_netdata_stream_api_key | default('changeme') }}"

# Control: Scanopy/Trivy (Container Security)
control_scanopy:
  enabled: true
  port: 8080
  trivy_version: "latest"

# Control: PruneMate (Docker Cleanup)
control_prunemate:
  enabled: true
  schedule: "0 3 * * 0"  # Weekly on Sunday at 3 AM

# =============================================================================
# SERVICE DISCOVERY & AUTO-REGISTRATION
# =============================================================================
# When enabled, services automatically register with the control node.

control_node_ip: ""  # Set during control node setup, e.g., "192.168.1.100"

service_discovery:
  enabled: false  # Enabled after control node setup
  netdata_streaming:
    enabled: false
    api_key: "{{ control_netdata.stream_api_key }}"
  log_aggregation:
    enabled: false
    extra_labels:
      environment: "production"
  uptime_monitoring:
    enabled: false
    monitored_services:
      - name: "Dockge"
        type: "http"
        port: "{{ target_dockge.port }}"
      - name: "Netdata"
        type: "http"
        port: "{{ target_netdata.port }}"
      - name: "SSH"
        type: "port"
        port: 22
  dns_registration:
    enabled: false
    domain: "internal"

# =============================================================================
# DEBUG & FEATURE FLAGS
# =============================================================================
debug_mode: false
